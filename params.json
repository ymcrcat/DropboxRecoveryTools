{"name":"Dropbox Recovery Tools","tagline":"Recover tons of deleted files in your Dropbox","body":"It all started a couple of days before a paper submission deadline - when I really needed my data accessible, and my code available. I store all my academic stuff in my Dropbox folder, so it is backed up to the cloud. Lo and behold, Murphy entered the game and caused my Mac to halt, and when I forced a reboot it apparently resulted in some inconsistent state of the Dropbox client. This drove Dropbox  into deleting tens of thousands of files from my account, causing files to be deleted remotely and locally, under the tips of my typing fingers. The only thing I had is previous remote revisions of the files.\r\nI don't have Dropbox Pro and therefore don't have <a href=\"https://www.dropbox.com/help/113/en\">PackRat</a>, which anyway I'm not sure would help in this case. Besides, I didn't actually care about indefinitely long history, but about quick and convenient recovery. I've decided to take a look at the Dropbox API. I found it quite easy, using the supplied <a href=\"https://www.dropbox.com/developers/core/sdks/python\">Python Dropbox SDK</a>, to write several tools to help me search and recover my deleted files.\r\nThe Dropbox Python SDK can be either downloaded and installed using <em>setup.py</em> or using\r\n```\r\n$ pip install dropbox\r\n```\r\nIn order to access your Dropbox you need to create a Dropbox application that's linked to your account. It can be done through the Dropbox application console (<a href=\"https://www.dropbox.com/developers/apps\">https://www.dropbox.com/developers/apps</a>) and gets you an application key and application secret which are later used by the Python scripts to obtain a token that enables accessing your Dropbox storage.\r\nI store the application key and secret in a JSON configuration file, and written a tiny helper script to generate this JSON (make_config.sh):\r\n```\r\necho \"{\r\n  \"app_key\" : \"$1\",\r\n  \"app_secret\" : \"$2\"\r\n}\"\r\n```\r\nThe code to obtain an access token for all further actions looks like that\r\n```\r\nimport dropbox\r\ndef get_token():\r\n  config = open(CONFIG_FILE, 'r')\r\n  config_data = json.load(config)\r\n  app_key = config_data['app_key']\r\n  app_secret = config_data['app_secret']\r\n\r\n  flow = dropbox.client.DropboxOAuth2FlowNoRedirect(app_key, app_secret)\r\n  authorize_url = flow.start()\r\n\r\n  # Have the user sign in and authorize this token\r\n  authorize_url = flow.start()\r\n  print '1. Go to: ' + authorize_url\r\n  print '2. Click \"Allow\" (you might have to log in first)'\r\n  print '3. Copy the authorization code.'\r\n  code = raw_input(\"Enter the authorization code here: \").strip()\r\n\r\n  # This will fail if the user enters an invalid authorization code\r\n  access_token, user_id = flow.finish(code)\r\n  return access_token\r\n```\r\n\r\nThe access token is stored in a cookie file for later use.\r\n```\r\ndef create_client():\r\n  try:\r\n    cookie_content = open(COOKIE_FILE, 'r').read()\r\n    access_token = json.loads(cookie_content)\r\n    client = dropbox.client.DropboxClient(access_token)\r\n  except Exception:\r\n    access_token = get_token()\r\n    client = dropbox.client.DropboxClient(access_token)\r\n    cookie_content = json.dumps(access_token)\r\n    open(COOKIE_FILE, 'w').write(cookie_content)\r\n```\r\nOnce we have initialized a client we have access to all kind of methods such as <em>metadata, revisions,  restore, file_delete, </em>etc. There are several utilities provided:<br>\r\n<em>find_deleted</em> - Finds deleted file under a given path (optionally by date)<br>\r\n<em>ls</em> - Lists files (optionally by date)<br>\r\n<em>restore_file</em> - Restores files. Paths are provided through standard input.<br>\r\n<em>delete_files</em> - Deletes files. Paths are provided through standard input.<br>\r\n\r\nUsing these utilities I was able to restore all my accidentally deleted files in a matter of hours. One small technical detail I had to apply is to handle rate limiting imposed by Dropbox. Once in a while an operation would result in an exception if too many actions were attempted in a short amount of time. I had to catch this, and retry the operation.\r\n\r\nThe code is available under <a href=\"https://github.com/ymcrcat/DropboxRecoveryTools\">https://github.com/ymcrcat/DropboxRecoveryTools</a>.\r\n\r\n### Authors and Contributors\r\nThe project is maintained by Yan Michalevsky (@ymcrcat).\r\nIf you have suggestions you can contact him using the contact form on http://www.stanford.edu/~yanm2/contact.html\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}